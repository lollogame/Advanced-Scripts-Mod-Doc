<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Scripts — IDE</title>

<!-- CodeMirror 5 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/dialog/dialog.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/matchesonscrollbar.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/comment/comment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/dialog/dialog.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/indent-fold.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.css">

<!-- JetBrains Mono for editor, Rajdhani for UI chrome -->
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ═══════════════════ RESET & ROOT ═══════════════════ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg0:      #141414;
  --bg1:      #1c1c1e;
  --bg2:      #232325;
  --bg3:      #2a2a2d;
  --bg4:      #323236;
  --border:   #3a3a3e;
  --border2:  #4a4a50;
  --text:     #d0d0d8;
  --text-dim: #7a7a88;
  --text-faint:#4a4a58;
  --accent:   #3dd68c;        /* Minecraft green */
  --accent2:  #4ec9b0;        /* teal */
  --accent3:  #569cd6;        /* blue */
  --red:      #f87171;
  --orange:   #fb923c;
  --yellow:   #fbbf24;

  /* Syntax */
  --syn-keyword:    #569cd6;
  --syn-builtin:    #dcdcaa;
  --syn-string:     #ce9178;
  --syn-number:     #b5cea8;
  --syn-comment:    #6a9955;
  --syn-command:    #4ec9b0;
  --syn-annotation: #c586c0;
  --syn-define:     #9cdcfe;
  --syn-operator:   #d4d4d4;
  --syn-fstring:    #d7ba7d;
  --syn-bracket:    #ffd700;
}

body {
  font-family: 'Rajdhani', 'Segoe UI', sans-serif;
  background: var(--bg0);
  color: var(--text);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  user-select: none;
}

/* ═══════════════════ TOP BAR ═══════════════════ */
#topbar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 16px;
  height: 44px;
  min-height: 44px;
  background: var(--bg1);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  z-index: 100;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.5px;
  margin-right: 8px;
}

.logo svg { width: 20px; height: 20px; }

.topbar-sep { width: 1px; height: 22px; background: var(--border); margin: 0 4px; }

.btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 12px;
  border-radius: 5px;
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--text);
  font-family: 'Rajdhani', sans-serif;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.3px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.btn:hover { background: var(--bg4); border-color: var(--border2); }
.btn.primary { background: #1a3d2b; border-color: var(--accent); color: var(--accent); }
.btn.primary:hover { background: #22523a; }
.btn.danger  { background: #3d1a1a; border-color: var(--red); color: var(--red); }
.btn.danger:hover  { background: #521a1a; }
.btn svg { width: 14px; height: 14px; flex-shrink: 0; }
.btn:disabled { opacity: 0.4; pointer-events: none; }

#btn-stop { display: none; }

.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 8px; }

#status-badge {
  padding: 3px 10px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.4px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text-dim);
  transition: all 0.2s;
}
#status-badge.running { background: #1a3d2b; border-color: var(--accent); color: var(--accent); }
#status-badge.error   { background: #3d1a1a; border-color: var(--red); color: var(--red); }

.kb-hint {
  font-size: 11px;
  color: var(--text-faint);
  letter-spacing: 0.2px;
}

kbd {
  display: inline-block;
  padding: 1px 5px;
  background: var(--bg3);
  border: 1px solid var(--border2);
  border-radius: 3px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-dim);
}

/* ═══════════════════ MAIN LAYOUT ═══════════════════ */
#main {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* ═══════════════════ SIDEBAR ═══════════════════ */
#sidebar {
  width: 220px;
  min-width: 180px;
  max-width: 320px;
  background: var(--bg1);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;
}

.sidebar-header {
  padding: 10px 14px 8px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1.2px;
  text-transform: uppercase;
  color: var(--text-dim);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}

.sidebar-header .icon-btn {
  width: 20px; height: 20px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 3px;
  cursor: pointer;
  color: var(--text-faint);
  transition: color 0.15s, background 0.15s;
}
.sidebar-header .icon-btn:hover { color: var(--text); background: var(--bg3); }
.sidebar-header .icon-btn svg { width: 13px; height: 13px; }

#file-tree {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 8px;
}

.tree-folder {
  padding: 5px 14px;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-dim);
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  border-radius: 4px;
  margin: 0 4px;
}
.tree-folder:hover { background: var(--bg3); color: var(--text); }
.tree-folder svg  { width: 13px; height: 13px; color: var(--yellow); flex-shrink: 0; }

.tree-file {
  padding: 4px 14px 4px 28px;
  font-size: 12.5px;
  font-weight: 500;
  color: var(--text-dim);
  cursor: pointer;
  border-radius: 4px;
  margin: 0 4px;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background 0.1s, color 0.1s;
}
.tree-file:hover   { background: var(--bg3); color: var(--text); }
.tree-file.active  { background: var(--bg4); color: var(--accent2); border-left: 2px solid var(--accent); padding-left: 26px; }
.tree-file svg     { width: 12px; height: 12px; flex-shrink: 0; }
.tree-file .dot-unsaved { width: 6px; height: 6px; border-radius: 50%; background: var(--orange); margin-left: auto; display: none; }
.tree-file.unsaved .dot-unsaved { display: block; }

/* scrollbar */
#file-tree::-webkit-scrollbar { width: 5px; }
#file-tree::-webkit-scrollbar-track { background: transparent; }
#file-tree::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* ═══════════════════ EDITOR AREA ═══════════════════ */
#editor-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
  overflow: hidden;
}

/* ── Tabs ── */
#tabs {
  display: flex;
  align-items: stretch;
  background: var(--bg1);
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  overflow-y: hidden;
  flex-shrink: 0;
  min-height: 36px;
}
#tabs::-webkit-scrollbar { height: 3px; }
#tabs::-webkit-scrollbar-thumb { background: var(--border); }

.tab {
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 0 14px;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-dim);
  cursor: pointer;
  border-right: 1px solid var(--border);
  white-space: nowrap;
  position: relative;
  transition: background 0.1s, color 0.1s;
  min-width: 100px;
}
.tab:hover { background: var(--bg2); color: var(--text); }
.tab.active {
  background: var(--bg0);
  color: var(--text);
  border-bottom: 2px solid var(--accent);
}
.tab .tab-close {
  width: 16px; height: 16px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 3px;
  color: var(--text-faint);
  margin-left: 4px;
  flex-shrink: 0;
}
.tab .tab-close:hover { background: var(--bg4); color: var(--red); }
.tab .tab-close svg { width: 10px; height: 10px; }
.tab .tab-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--orange); display: none; }
.tab.unsaved .tab-dot { display: block; }
.tab .tab-icon { color: var(--accent2); flex-shrink: 0; }
.tab .tab-icon svg { width: 12px; height: 12px; }

/* ── CodeMirror wrapper ── */
#cm-wrapper {
  flex: 1;
  min-height: 0;
  overflow: hidden;
  background: var(--bg0);
}

.CodeMirror {
  height: 100% !important;
  font-family: 'JetBrains Mono', 'Fira Code', monospace !important;
  font-size: 14px !important;
  line-height: 1.7 !important;
  background: var(--bg0) !important;
  color: #d4d4d4 !important;
  letter-spacing: 0.01em;
}
.CodeMirror-scroll { padding-bottom: 60px; }
.CodeMirror-gutters {
  background: var(--bg1) !important;
  border-right: 1px solid var(--border) !important;
  padding-right: 2px;
}
.CodeMirror-linenumber { color: var(--text-faint) !important; font-size: 12px; padding: 0 10px 0 6px; }
.CodeMirror-activeline-background { background: rgba(255,255,255,0.03) !important; }
.CodeMirror-selected { background: rgba(78,201,176,0.15) !important; }
.CodeMirror-cursor { border-left: 2px solid var(--accent2) !important; }
.CodeMirror-matchingbracket { background: rgba(255,215,0,0.2) !important; color: var(--yellow) !important; }
.cm-tab { background: repeating-linear-gradient(90deg,transparent,transparent 3px,rgba(255,255,255,0.05) 3px,rgba(255,255,255,0.05) 4px); }

/* Fold gutter */
.CodeMirror-foldgutter-open, .CodeMirror-foldgutter-folded { color: var(--text-faint); cursor: pointer; }
.CodeMirror-foldgutter-open:hover, .CodeMirror-foldgutter-folded:hover { color: var(--accent2); }

/* ── Syntax token colors ── */
.cm-s-script span.cm-keyword    { color: var(--syn-keyword); font-weight: 600; }
.cm-s-script span.cm-builtin    { color: var(--syn-builtin); }
.cm-s-script span.cm-string     { color: var(--syn-string); }
.cm-s-script span.cm-string-2   { color: var(--syn-fstring); }
.cm-s-script span.cm-number     { color: var(--syn-number); }
.cm-s-script span.cm-comment    { color: var(--syn-comment); font-style: italic; }
.cm-s-script span.cm-command    { color: var(--syn-command); font-weight: 500; }
.cm-s-script span.cm-annotation { color: var(--syn-annotation); font-weight: 600; }
.cm-s-script span.cm-define     { color: var(--syn-define); }
.cm-s-script span.cm-operator   { color: var(--syn-operator); }
.cm-s-script span.cm-variable   { color: #9cdcfe; }
.cm-s-script span.cm-variable-2 { color: #c8c8ff; }
.cm-s-script span.cm-bracket    { color: var(--syn-bracket); }
.cm-s-script span.cm-def        { color: #dcdcaa; font-weight: 600; }
.cm-s-script span.cm-property   { color: #9cdcfe; }
.cm-s-script span.cm-error      { background: rgba(248,113,113,0.15); color: var(--red); }
.cm-s-script span.cm-fstring-brace { color: var(--syn-fstring); font-weight: 600; }

/* ═══════════════════ CONSOLE / PANEL ═══════════════════ */
#panel {
  height: 180px;
  min-height: 80px;
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  background: var(--bg1);
  flex-shrink: 0;
}

#panel-resize {
  height: 4px;
  background: transparent;
  cursor: ns-resize;
  flex-shrink: 0;
}
#panel-resize:hover { background: var(--accent2); }

#panel-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 14px;
  height: 32px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.panel-tab {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.5px;
  color: var(--text-dim);
  padding: 0 6px;
  cursor: pointer;
  height: 100%;
  display: flex;
  align-items: center;
  border-bottom: 2px solid transparent;
  transition: color 0.1s;
}
.panel-tab.active { color: var(--accent2); border-bottom-color: var(--accent2); }
.panel-tab:hover { color: var(--text); }

.panel-right { margin-left: auto; display: flex; align-items: center; gap: 8px; }
.icon-btn-sm {
  width: 22px; height: 22px; display: flex; align-items: center; justify-content: center;
  border-radius: 4px; cursor: pointer; color: var(--text-faint); transition: all 0.1s;
}
.icon-btn-sm:hover { color: var(--text); background: var(--bg3); }
.icon-btn-sm svg { width: 12px; height: 12px; }

#console-output {
  flex: 1;
  overflow-y: auto;
  padding: 8px 14px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12.5px;
  line-height: 1.7;
  color: var(--text);
}
#console-output::-webkit-scrollbar { width: 5px; }
#console-output::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

.log-line { display: flex; gap: 8px; }
.log-line .log-ts  { color: var(--text-faint); flex-shrink: 0; }
.log-line .log-msg { flex: 1; word-break: break-all; }
.log-line.log-info  .log-msg { color: var(--text); }
.log-line.log-ok    .log-msg { color: var(--accent); }
.log-line.log-warn  .log-msg { color: var(--yellow); }
.log-line.log-error .log-msg { color: var(--red); }
.log-line.log-cmd   .log-msg { color: var(--syn-command); }
.log-line.log-sys   .log-msg { color: var(--text-dim); font-style: italic; }

.console-empty {
  color: var(--text-faint);
  font-size: 12px;
  font-style: italic;
  margin-top: 4px;
}

/* ═══════════════════ STATUSBAR ═══════════════════ */
#statusbar {
  height: 24px;
  min-height: 24px;
  background: #0e2d20;
  border-top: 1px solid var(--accent);
  display: flex;
  align-items: center;
  padding: 0 14px;
  gap: 16px;
  font-size: 11.5px;
  color: #6a9955;
  letter-spacing: 0.3px;
  flex-shrink: 0;
}
.sb-item { display: flex; align-items: center; gap: 5px; }
.sb-sep  { width: 1px; height: 12px; background: #1a5c32; }
.sb-right { margin-left: auto; display: flex; gap: 16px; align-items: center; }
#sb-pos, #sb-lines, #sb-lang { color: #6a9955; }

/* ═══════════════════ WELCOME SCREEN ═══════════════════ */
#welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 16px;
  color: var(--text-faint);
  font-size: 14px;
  text-align: center;
  padding: 40px;
}
#welcome h2 { font-size: 22px; font-weight: 700; color: var(--accent); letter-spacing: 0.5px; }
#welcome p  { color: var(--text-dim); font-size: 13px; line-height: 1.7; max-width: 400px; }
.welcome-shortcut { display: flex; gap: 8px; align-items: center; justify-content: center; color: var(--text-dim); font-size: 12px; margin-top: 4px; }
#welcome .welcome-files { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 8px; }
#welcome .wf-btn {
  padding: 6px 14px;
  border: 1px solid var(--border);
  border-radius: 5px;
  background: var(--bg2);
  color: var(--accent2);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}
#welcome .wf-btn:hover { background: var(--bg3); border-color: var(--accent2); }

/* ═══════════════════ RESIZE HANDLE (sidebar) ═══════════════════ */
#sidebar-resize {
  width: 4px;
  background: transparent;
  cursor: ew-resize;
  flex-shrink: 0;
}
#sidebar-resize:hover { background: var(--accent2); }

/* ═══════════════════ SEARCH HIGHLIGHT ═══════════════════ */
.CodeMirror-search-match { background: rgba(255,215,0,0.25) !important; }
</style>
</head>
<body>

<!-- ═══════════ TOP BAR ═══════════ -->
<div id="topbar">
  <div class="logo">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Advanced Scripts
  </div>
  <div class="topbar-sep"></div>

  <button class="btn" id="btn-new" title="New file (Ctrl+N)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
    New
  </button>

  <button class="btn" id="btn-save" title="Save (Ctrl+S)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
    Save
  </button>

  <div class="topbar-sep"></div>

  <button class="btn primary" id="btn-run" title="Run (Ctrl+Enter)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
    Run
  </button>

  <button class="btn danger" id="btn-stop" title="Stop (Ctrl+.)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
    Stop
  </button>

  <div class="topbar-sep"></div>
  <span id="status-badge">IDLE</span>
  <span class="kb-hint"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> Run &nbsp;·&nbsp; <kbd>Ctrl</kbd>+<kbd>S</kbd> Save &nbsp;·&nbsp; <kbd>Ctrl</kbd>+<kbd>/</kbd> Comment &nbsp;·&nbsp; <kbd>Ctrl</kbd>+<kbd>F</kbd> Find</span>

  <div class="topbar-right">
    <button class="btn" id="btn-docs" title="Open Documentation">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
      Docs
    </button>
  </div>
</div>

<!-- ═══════════ MAIN ═══════════ -->
<div id="main">

  <!-- Sidebar -->
  <div id="sidebar">
    <div class="sidebar-header">
      Explorer
      <div class="icon-btn" id="btn-new-file" title="New file">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </div>
    </div>
    <div id="file-tree"></div>
  </div>
  <div id="sidebar-resize"></div>

  <!-- Editor + panel -->
  <div id="editor-area">
    <div id="tabs"></div>
    <div id="cm-wrapper">
      <div id="welcome">
        <h2>Advanced Scripts IDE</h2>
        <p>Select a file from the explorer or create a new one.<br>Full syntax highlighting for the Advanced Scripts language.</p>
        <div class="welcome-files" id="welcome-files"></div>
        <div class="welcome-shortcut">
          <kbd>Ctrl</kbd>+<kbd>N</kbd> — New file &nbsp;·&nbsp; <kbd>Ctrl</kbd>+<kbd>Enter</kbd> — Run
        </div>
      </div>
    </div>

    <!-- Bottom panel -->
    <div id="panel">
      <div id="panel-resize"></div>
      <div id="panel-header">
        <span class="panel-tab active" data-tab="console">CONSOLE</span>
        <div class="panel-right">
          <div class="icon-btn-sm" id="btn-clear-console" title="Clear">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg>
          </div>
        </div>
      </div>
      <div id="console-output">
        <div class="console-empty">Console output will appear here. Press Ctrl+Enter to simulate running your script.</div>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════ STATUSBAR ═══════════ -->
<div id="statusbar">
  <div class="sb-item">
    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
    <span id="sb-filename">No file open</span>
  </div>
  <div class="sb-sep"></div>
  <div class="sb-item"><span id="sb-lang">Script</span></div>

  <div class="sb-right">
    <div class="sb-item"><span id="sb-lines">0 lines</span></div>
    <div class="sb-sep"></div>
    <div class="sb-item">Ln <span id="sb-pos">1</span></div>
  </div>
</div>

<script>
// ════════════════════════════════════════════════════════════════
//  Demo file system (in-memory)
// ════════════════════════════════════════════════════════════════
const FS = {
  "example.script": `# ══════════════════════════════════════════════════
#  example.script — Syntax showcase
#  Run: /scripts run example
# ══════════════════════════════════════════════════

# Variables & types
name    = "Steve"
age     = 20
height  = 1.8
is_op   = True
nothing = None

# Augmented assignment
score = 10
score += 5    # 15
score *= 2    # 30
score //= 4   # 7
power = 2 ** 8   # 256

# F-strings
greeting = f"Hello, {name}! Age {age}."
print(greeting)

# Lists
items = ["sword", "shield", "bow"]
items.append("arrows")
items.insert(0, "helmet")
first  = items[0]
last   = items[-1]

# Dicts
player = {"name": "Steve", "hp": 20, "level": 5}
player["xp"] = 150
player["hp"] -= 5

# If / elif / else
if score > 10:
    print("High score!")
elif score > 5:
    print("Decent score")
else:
    print("Keep trying")

# For loop
total = 0
for i in range(1, 6):
    total += i
print(f"Sum 1..5 = {total}")

# While + break/continue
counter = 0
while True:
    counter += 1
    if counter == 3:
        continue
    if counter >= 5:
        break
print(f"counter ended at {counter}")

# Functions
def greet(player_name, times=1):
    msg = f"Hello {player_name}!"
    for i in range(times):
        print(msg)
    return times * 2

result = greet("Alex", 2)

# @macro
@macro
def give_reward(player, amount):
    /give {player} minecraft:diamond {amount}
    /say {player} received {amount} diamonds!

give_reward(name, 5)

# Minecraft commands
target = "Steve"
/say Script running for {target}
/time set day
wait(20)
/say Done!`,

  "math.script": `@LIBRARY
# ═══════════════════════════════════════════════════════════════
#  math.script — Math library
#  from math import sqrt, clamp, lerp, PI
# ═══════════════════════════════════════════════════════════════

PI      = 3.141592653589793
TAU     = 6.283185307179586
E       = 2.718281828459045
INF     = 999999999
NEG_INF = -999999999

def floor(x):
    n = int(x)
    if x < 0 and x != n:
        n = n - 1
    return n

def ceil(x):
    n = int(x)
    if x > 0 and x != n:
        n = n + 1
    return n

def abs_val(x):
    if x < 0:
        return x * -1
    return x

def clamp(value, low, high):
    if value < low:
        return low
    if value > high:
        return high
    return value

def clamp01(value):
    return clamp(value, 0, 1)

def sqrt(x):
    if x <= 0:
        return 0
    guess = x / 2.0
    i = 0
    while i < 50:
        guess = (guess + x / guess) / 2.0
        i += 1
    return guess

def lerp(a, b, t):
    return a + (b - a) * clamp01(t)

def distance_2d(x1, z1, x2, z2):
    dx = x2 - x1
    dz = z2 - z1
    return sqrt(dx * dx + dz * dz)

def distance_3d(x1, y1, z1, x2, y2, z2):
    dx = x2 - x1
    dy = y2 - y1
    dz = z2 - z1
    return sqrt(dx * dx + dy * dy + dz * dz)

def is_prime(n):
    n = int(n)
    if n < 2:
        return False
    i = 2
    while i * i <= n:
        if n % i == 0:
            return False
        i += 1
    return True

def fibonacci(n):
    n = int(n)
    if n <= 0:
        return 0
    if n == 1:
        return 1
    a = 0
    b = 1
    i = 2
    while i <= n:
        temp = a + b
        a = b
        b = temp
        i += 1
    return b`,

  "events/on_join.script": `@PREPARE
# ═══════════════════════════════════════════════════
#  events/on_join.script
#  Welcome script — runs on server start
# ═══════════════════════════════════════════════════

from math import distance_3d

def greet_player(player):
    hp    = player_health(player)
    maxhp = player_max_health(player)
    lvl   = player_level(player)
    pos   = player_pos(player)
    day   = world_day()

    /tellraw {player} {"text":"","extra":[{"text":"Welcome back, ","color":"gold"},{"text":"{player}","color":"yellow","bold":true},{"text":"!","color":"gold"}]}
    /tell {player} §eHP: §f{hp}/{maxhp}  Level: {lvl}  Day: {day}
    /tell {player} §ePosition: §f{int(pos[0])}, {int(pos[1])}, {int(pos[2])}

/say §a§lServer ready — Day {world_day()}`,

  "events/monitor.script": `@PREPARE
# ═══════════════════════════════════════════════════
#  events/monitor.script
#  Server health monitor
# ═══════════════════════════════════════════════════

#define CHECK_INTERVAL  200
#define MIN_TPS         16

while True:
    tps    = server_tps()
    mspt   = server_mspt()
    online = player_count()
    maxp   = server_max_players()

    if tps < MIN_TPS:
        /say §c[Monitor] Low TPS: {tps} ({mspt}ms/tick) — {online}/{maxp} players

    # Check all players health
    for p in player_list():
        hp    = player_health(p)
        maxhp = player_max_health(p)
        if hp < maxhp * 0.2:
            /tell {p} §c⚠ Low health: {int(hp)}/{int(maxhp)} HP!

    wait(CHECK_INTERVAL)`,

  "lib/rewards.script": `@LIBRARY
# ═══════════════════════════════════════════════════
#  lib/rewards.script — Reward utilities
# ═══════════════════════════════════════════════════

#define DIAMOND_ID  "minecraft:diamond"
#define EMERALD_ID  "minecraft:emerald"
#define XP_BASE     10

def give_diamonds(player, count=5):
    /give {player} {DIAMOND_ID} {count}
    /xp add {player} {count * XP_BASE} points
    /say {player} earned {count} diamonds!

def give_emeralds(player, count=3):
    /give {player} {EMERALD_ID} {count}

def reward_by_level(player):
    lvl = player_level(player)
    if lvl >= 30:
        give_diamonds(player, 10)
    elif lvl >= 15:
        give_diamonds(player, 5)
    else:
        give_diamonds(player, 2)

@macro
def announce_reward(player, msg):
    /title {player} times 10 40 10
    /title {player} subtitle {"text":"{msg}","color":"gold"}
    /title {player} title {"text":" "}
    /say §6{player}: {msg}`,

  "new_script.script": `# ═══════════════════════════════════════════════════
#  new_script.script
# ═══════════════════════════════════════════════════

/say Hello from new script!
`
};

// ════════════════════════════════════════════════════════════════
//  Custom CodeMirror Mode: scriptlang
// ════════════════════════════════════════════════════════════════
CodeMirror.defineMode("scriptlang", function() {
  const keywords = new Set([
    "if","elif","else","for","while","def","return","and","or","not","in",
    "True","False","None","break","continue","pass","global","import","from","as"
  ]);

  const builtins = new Set([
    // core
    "print","wait","len","range","int","float","str","bool","abs","min","max",
    "round","sorted","reversed","sum","enumerate","zip","list","dict","type",
    "input","hasattr","getattr",
    // player
    "player_online","player_list","player_count","player_health","player_max_health",
    "player_hunger","player_saturation","player_level","player_xp","player_total_xp",
    "player_gamemode","player_score","player_x","player_y","player_z","player_pos",
    "player_yaw","player_pitch","player_dimension","player_flying","player_sneaking",
    "player_sprinting","player_on_ground","player_in_water","player_is_op",
    "player_inventory","player_hand","player_nbt","player_nbt_tag",
    // world / server
    "world_time","world_day_time","world_day","world_weather","world_difficulty",
    "world_spawn","server_max_players","server_tps","server_mspt",
    // blocks
    "block_at","block_is_air","block_light",
    // entities
    "entity_count","entity_list","entity_type","entity_name","entity_uuid",
    "entity_pos","entity_x","entity_y","entity_z","entity_yaw","entity_pitch",
    "entity_dimension","entity_health","entity_max_health","entity_velocity",
    "entity_tags","entity_has_tag","entity_alive","entity_on_fire","entity_on_ground",
    "entity_in_water","entity_silent","entity_no_gravity","entity_is_baby",
    "entity_nbt","entity_nbt_all","entity_nbt_tag"
  ]);

  function tokenBase(stream, state) {
    // F-string brace interpolation context
    if (state.inFStringExpr) {
      if (stream.eat('}')) { state.inFStringExpr = false; state.inFString = true; return "fstring-brace"; }
      // simple token inside {}
      if (stream.match(/\w+/)) return "variable";
      stream.next(); return "fstring-brace";
    }

    // Inside f-string
    if (state.inFString) {
      if (stream.eat(state.fStringQuote)) { state.inFString = false; return "string-2"; }
      if (stream.eat('{')) {
        if (stream.peek() === '{') { stream.next(); return "string-2"; }
        state.inFStringExpr = true; return "fstring-brace";
      }
      if (stream.match(/[^{}'"]*/)) return "string-2";
      stream.next(); return "string-2";
    }

    // Line start
    if (stream.sol()) {
      // Minecraft command
      if (stream.peek() === '/') {
        stream.skipToEnd();
        return "command";
      }
      // Annotation: @PREPARE, @LIBRARY, @RUN, @macro
      if (stream.peek() === '@') {
        stream.match(/@\w+/);
        return "annotation";
      }
      // Preprocessor: #define
      if (stream.match(/#define/)) {
        stream.skipToEnd();
        return "define";
      }
    }

    // Comment
    if (stream.peek() === '#') {
      stream.skipToEnd();
      return "comment";
    }

    // F-string or regular string
    const nextCh = stream.peek();
    if (nextCh === '"' || nextCh === "'") {
      const prevCh = stream.string.substring(0, stream.pos - 1).trimRight().slice(-1);
      const isFStr = prevCh === 'f' || prevCh === 'F';
      const q = stream.next();
      if (isFStr) {
        state.inFString = true;
        state.fStringQuote = q;
        return "string-2";
      }
      // plain string
      while (!stream.eol()) {
        const ch = stream.next();
        if (ch === '\\') { stream.next(); continue; }
        if (ch === q) break;
      }
      return "string";
    }

    // Number
    if (stream.match(/^-?(?:0x[\da-fA-F]+|\d+\.?\d*(?:[eE][+-]?\d+)?)/)) return "number";

    // Identifier / keyword / builtin
    if (stream.match(/^[a-zA-Z_]\w*/)) {
      const word = stream.current();
      if (keywords.has(word)) return "keyword";
      if (builtins.has(word)) return "builtin";
      // function definition name
      const before = stream.string.substring(0, stream.pos - word.length).trim();
      if (before.endsWith('def')) return "def";
      // function call
      if (stream.peek() === '(') return "def";
      // attribute access result
      return "variable";
    }

    // Operators
    if (stream.match(/^(?:==|!=|<=|>=|<<=|>>=|\*\*=|\/\/=|[+\-*/%&|^~]=?|<<|>>|\*\*|\/\/|[<>]=?|=)/)) return "operator";

    // Brackets
    if (stream.match(/^[()[\]{}]/)) return "bracket";

    stream.next();
    return null;
  }

  return {
    startState() {
      return { inFString: false, fStringQuote: null, inFStringExpr: false };
    },
    token(stream, state) {
      return tokenBase(stream, state);
    },
    indent(state, textAfter) {
      return CodeMirror.Pass;
    },
    lineComment: "#",
    fold: "indent"
  };
});

// ════════════════════════════════════════════════════════════════
//  Editor state
// ════════════════════════════════════════════════════════════════
let openTabs = [];   // { id, name, content, unsaved }
let activeTab = null;
let editors = {};    // id -> content string (saved state)
let cmEditor = null;
let isRunning = false;

function nextId() { return Math.random().toString(36).slice(2); }

// ════════════════════════════════════════════════════════════════
//  File tree
// ════════════════════════════════════════════════════════════════
function buildFileTree() {
  const tree = document.getElementById('file-tree');
  tree.innerHTML = '';

  // Group by folder
  const folders = {};
  const rootFiles = [];

  for (const name of Object.keys(FS)) {
    const parts = name.split('/');
    if (parts.length === 1) {
      rootFiles.push(name);
    } else {
      const folder = parts.slice(0, -1).join('/');
      if (!folders[folder]) folders[folder] = [];
      folders[folder].push(name);
    }
  }

  // Root files
  for (const name of rootFiles) {
    tree.appendChild(makeFileEl(name));
  }

  // Folders
  for (const [folder, files] of Object.entries(folders)) {
    const folderEl = document.createElement('div');
    folderEl.className = 'tree-folder';
    folderEl.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>${folder}`;
    tree.appendChild(folderEl);
    for (const name of files) {
      const fe = makeFileEl(name);
      fe.style.paddingLeft = '38px';
      tree.appendChild(fe);
    }
  }

  // Update welcome quick-open buttons
  const wf = document.getElementById('welcome-files');
  if (wf) {
    wf.innerHTML = '';
    for (const name of Object.keys(FS).slice(0, 6)) {
      const btn = document.createElement('div');
      btn.className = 'wf-btn';
      btn.textContent = name.split('/').pop();
      btn.onclick = () => openFile(name);
      wf.appendChild(btn);
    }
  }
}

function makeFileEl(name) {
  const el = document.createElement('div');
  el.className = 'tree-file';
  el.dataset.file = name;
  const short = name.split('/').pop();
  el.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--accent2)"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
    ${short}
    <span class="dot-unsaved"></span>`;
  el.onclick = () => openFile(name);
  return el;
}

function refreshFileTree() {
  document.querySelectorAll('.tree-file').forEach(el => {
    const fn = el.dataset.file;
    const tab = openTabs.find(t => t.name === fn);
    el.classList.toggle('active', !!tab && tab.id === activeTab);
    el.classList.toggle('unsaved', !!tab && tab.unsaved);
  });
}

// ════════════════════════════════════════════════════════════════
//  Tabs
// ════════════════════════════════════════════════════════════════
function renderTabs() {
  const tabBar = document.getElementById('tabs');
  tabBar.innerHTML = '';
  for (const tab of openTabs) {
    const el = document.createElement('div');
    el.className = 'tab' + (tab.id === activeTab ? ' active' : '') + (tab.unsaved ? ' unsaved' : '');
    el.dataset.id = tab.id;
    const short = tab.name.split('/').pop();
    el.innerHTML = `
      <span class="tab-dot"></span>
      <span class="tab-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></span>
      <span style="flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis">${short}</span>
      <span class="tab-close" data-id="${tab.id}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </span>`;
    el.addEventListener('click', (e) => {
      if (!e.target.closest('.tab-close')) switchTab(tab.id);
    });
    el.querySelector('.tab-close').addEventListener('click', (e) => {
      e.stopPropagation(); closeTab(tab.id);
    });
    tabBar.appendChild(el);
  }
}

function switchTab(id) {
  if (activeTab === id) return;
  if (activeTab && cmEditor) {
    const cur = openTabs.find(t => t.id === activeTab);
    if (cur) cur.content = cmEditor.getValue();
  }
  activeTab = id;
  const tab = openTabs.find(t => t.id === id);
  if (!tab) return;

  ensureEditor();
  cmEditor.setValue(tab.content);
  cmEditor.clearHistory();
  cmEditor.focus();
  updateStatusBar();
  renderTabs();
  refreshFileTree();
  document.getElementById('welcome').style.display = 'none';
}

function closeTab(id) {
  const idx = openTabs.findIndex(t => t.id === id);
  if (idx === -1) return;
  openTabs.splice(idx, 1);
  if (activeTab === id) {
    activeTab = openTabs.length ? openTabs[Math.max(0, idx - 1)].id : null;
    if (activeTab) {
      switchTab(activeTab);
    } else {
      document.getElementById('welcome').style.display = 'flex';
      document.getElementById('sb-filename').textContent = 'No file open';
    }
  }
  renderTabs();
  refreshFileTree();
}

// ════════════════════════════════════════════════════════════════
//  Open / New file
// ════════════════════════════════════════════════════════════════
function openFile(name) {
  const existing = openTabs.find(t => t.name === name);
  if (existing) { switchTab(existing.id); return; }

  const id = nextId();
  openTabs.push({ id, name, content: FS[name] || '', unsaved: false });
  renderTabs();
  switchTab(id);
}

function newFile() {
  const name = `script_${Date.now()}.script`;
  FS[name] = `# ${name}\n\n/say Hello World!\n`;
  buildFileTree();
  openFile(name);
  markUnsaved();
}

// ════════════════════════════════════════════════════════════════
//  CodeMirror instance
// ════════════════════════════════════════════════════════════════
function ensureEditor() {
  if (cmEditor) return;
  const wrapper = document.getElementById('cm-wrapper');
  cmEditor = CodeMirror(wrapper, {
    mode: 'scriptlang',
    theme: 'script',
    lineNumbers: true,
    matchBrackets: true,
    autoCloseBrackets: true,
    styleActiveLine: true,
    indentWithTabs: false,
    tabSize: 4,
    indentUnit: 4,
    extraKeys: {
      "Tab": (cm) => { cm.execCommand("insertSoftTab"); },
      "Ctrl-/": "toggleComment",
      "Ctrl-Enter": runScript,
      "Ctrl-S": saveFile,
      "Ctrl-.": stopScript,
      "Ctrl-N": newFile,
    },
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
  });

  cmEditor.on('change', () => {
    const tab = openTabs.find(t => t.id === activeTab);
    if (tab && !tab.unsaved) markUnsaved();
    updateStatusBar();
  });

  cmEditor.on('cursorActivity', updateStatusBar);
}

function markUnsaved() {
  const tab = openTabs.find(t => t.id === activeTab);
  if (tab) { tab.unsaved = true; renderTabs(); refreshFileTree(); }
}

function updateStatusBar() {
  if (!cmEditor || !activeTab) return;
  const tab = openTabs.find(t => t.id === activeTab);
  if (!tab) return;
  const cur = cmEditor.getCursor();
  document.getElementById('sb-pos').textContent = cur.line + 1;
  document.getElementById('sb-lines').textContent = cmEditor.lineCount() + ' lines';
  document.getElementById('sb-filename').textContent = (tab.unsaved ? '● ' : '') + tab.name;
}

// ════════════════════════════════════════════════════════════════
//  Save
// ════════════════════════════════════════════════════════════════
function saveFile() {
  if (!cmEditor || !activeTab) return;
  const tab = openTabs.find(t => t.id === activeTab);
  if (!tab) return;
  tab.content = cmEditor.getValue();
  FS[tab.name] = tab.content;
  tab.unsaved = false;
  renderTabs();
  refreshFileTree();
  updateStatusBar();
  addLog('sys', `Saved: ${tab.name}`);
}

// ════════════════════════════════════════════════════════════════
//  Run simulation
// ════════════════════════════════════════════════════════════════
function setRunning(running) {
  isRunning = running;
  document.getElementById('btn-run').style.display  = running ? 'none' : 'flex';
  document.getElementById('btn-stop').style.display = running ? 'flex' : 'none';
  const badge = document.getElementById('status-badge');
  badge.textContent = running ? 'RUNNING' : 'IDLE';
  badge.className   = running ? 'running' : '';
}

function runScript() {
  if (isRunning) return;
  if (!cmEditor || !activeTab) { addLog('error', 'No file open.'); return; }

  const tab = openTabs.find(t => t.id === activeTab);
  if (!tab) return;
  saveFile();

  const code = cmEditor.getValue();
  const lines = code.split('\n');
  const name = tab.name.replace('.script','');

  addLog('sys', '─'.repeat(60));
  addLog('ok', `▶ Running: ${tab.name}`);
  setRunning(true);

  // Simulate execution
  let delay = 0;
  const timers = [];

  for (let i = 0; i < lines.length; i++) {
    if (!isRunning) break;
    const raw = lines[i].trim();
    if (!raw || raw.startsWith('#') || raw.startsWith('@') || raw.startsWith('#define')) continue;

    const lineNum = i + 1;

    if (raw.startsWith('/')) {
      const cmd = raw.replace(/\{[^}]+\}/g, match => {
        const expr = match.slice(1,-1);
        return `<${expr}>`;
      });
      const t = setTimeout(() => {
        if (!isRunning) return;
        addLog('cmd', `[${name}:${lineNum}] /${cmd.slice(1)}`);
      }, delay);
      timers.push(t);
      delay += 80;
    } else if (raw.startsWith('print(')) {
      const t = setTimeout(() => {
        if (!isRunning) return;
        addLog('info', `[${name}:${lineNum}] ${raw}`);
      }, delay);
      timers.push(t);
      delay += 50;
    } else if (raw.startsWith('wait(')) {
      const ticks = parseInt(raw.match(/\d+/) || ['20']) ;
      const t = setTimeout(() => {
        if (!isRunning) return;
        addLog('sys', `[${name}:${lineNum}] wait(${ticks}) — ${ticks * 50}ms`);
      }, delay);
      timers.push(t);
      delay += Math.min(ticks * 50, 500);
    }
  }

  const finalTimer = setTimeout(() => {
    if (!isRunning) return;
    addLog('ok', `✓ Script finished: ${tab.name}`);
    setRunning(false);
  }, delay + 100);
  timers.push(finalTimer);

  // Attach stop handler
  window._scriptTimers = timers;
}

function stopScript() {
  if (!isRunning) return;
  if (window._scriptTimers) {
    window._scriptTimers.forEach(t => clearTimeout(t));
    window._scriptTimers = [];
  }
  setRunning(false);
  addLog('warn', '⏹ Script stopped.');
}

// ════════════════════════════════════════════════════════════════
//  Console
// ════════════════════════════════════════════════════════════════
function addLog(type, msg) {
  const out = document.getElementById('console-output');
  const empty = out.querySelector('.console-empty');
  if (empty) empty.remove();

  const now = new Date();
  const ts = now.toLocaleTimeString('en', {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false});

  const line = document.createElement('div');
  line.className = `log-line log-${type}`;
  line.innerHTML = `<span class="log-ts">${ts}</span><span class="log-msg">${escHtml(msg)}</span>`;
  out.appendChild(line);

  // Auto-scroll
  out.scrollTop = out.scrollHeight;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

document.getElementById('btn-clear-console').addEventListener('click', () => {
  const out = document.getElementById('console-output');
  out.innerHTML = '<div class="console-empty">Console cleared.</div>';
});

// ════════════════════════════════════════════════════════════════
//  Buttons
// ════════════════════════════════════════════════════════════════
document.getElementById('btn-run').addEventListener('click', runScript);
document.getElementById('btn-stop').addEventListener('click', stopScript);
document.getElementById('btn-save').addEventListener('click', saveFile);
document.getElementById('btn-new').addEventListener('click', newFile);
document.getElementById('btn-new-file').addEventListener('click', newFile);
document.getElementById('btn-docs').addEventListener('click', () => {
  window.open('docs.html', '_blank');
});

// ════════════════════════════════════════════════════════════════
//  Resizable panel
// ════════════════════════════════════════════════════════════════
(function() {
  const handle = document.getElementById('panel-resize');
  const panel  = document.getElementById('panel');
  let dragging = false, startY = 0, startH = 0;

  handle.addEventListener('mousedown', e => {
    dragging = true;
    startY = e.clientY;
    startH = panel.offsetHeight;
    document.body.style.cursor = 'ns-resize';
    e.preventDefault();
  });
  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    const delta = startY - e.clientY;
    const newH = Math.max(60, Math.min(window.innerHeight * 0.6, startH + delta));
    panel.style.height = newH + 'px';
    if (cmEditor) cmEditor.refresh();
  });
  document.addEventListener('mouseup', () => {
    dragging = false;
    document.body.style.cursor = '';
  });
})();

// ════════════════════════════════════════════════════════════════
//  Resizable sidebar
// ════════════════════════════════════════════════════════════════
(function() {
  const handle = document.getElementById('sidebar-resize');
  const sidebar = document.getElementById('sidebar');
  let dragging = false, startX = 0, startW = 0;

  handle.addEventListener('mousedown', e => {
    dragging = true;
    startX = e.clientX;
    startW = sidebar.offsetWidth;
    document.body.style.cursor = 'ew-resize';
    e.preventDefault();
  });
  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    const newW = Math.max(140, Math.min(400, startW + (e.clientX - startX)));
    sidebar.style.width = newW + 'px';
  });
  document.addEventListener('mouseup', () => {
    dragging = false;
    document.body.style.cursor = '';
  });
})();

// ════════════════════════════════════════════════════════════════
//  Global keyboard
// ════════════════════════════════════════════════════════════════
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 's') { e.preventDefault(); saveFile(); }
  if ((e.ctrlKey || e.metaKey) && e.key === 'n') { e.preventDefault(); newFile(); }
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); runScript(); }
  if ((e.ctrlKey || e.metaKey) && e.key === '.') { e.preventDefault(); stopScript(); }
});

// ════════════════════════════════════════════════════════════════
//  Boot
// ════════════════════════════════════════════════════════════════
buildFileTree();
addLog('sys', 'Advanced Scripts IDE ready.');
addLog('sys', 'Select a file to start editing, or press Ctrl+N for a new file.');

// Auto-open example
openFile('example.script');
</script>
</body>
</html>
